import{c as j,a as $,_ as M,b as k,u as N,j as e,r as i,M as D}from"./index-CPTFzE6R.js";import{S as F,$ as A,a as R,b as O}from"./module-C5eIFbko.js";/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=j("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const C=j("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=j("File",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=j("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=j("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=j("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=j("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.460.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=j("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),y=$((s,a)=>({messages:[],users:[],allUsers:[],selectedUser:null,isUsersLoading:!1,isMessagesLoading:!1,handleError:t=>{var n,c;console.error("Error: ",t);const l=((c=(n=t==null?void 0:t.response)==null?void 0:n.data)==null?void 0:c.message)||"Something went wrong, please try again.";M.error(l)},getUsers:async()=>{s({isUsersLoading:!0});try{const t=await k.get("/messages/users");s({users:t.data})}catch(t){a().handleError(t)}finally{s({isUsersLoading:!1})}},getAllUsers:async()=>{s({isUsersLoading:!0});try{const t=await k.get("/messages/all-users");s({allUsers:t.data})}catch(t){a().handleError(t)}finally{s({isUsersLoading:!1})}},getMessages:async t=>{s({isMessagesLoading:!0});try{const l=await k.get(`/messages/${t}`);s({messages:l.data})}catch(l){a().handleError(l)}finally{s({isMessagesLoading:!1})}},sendMessage:async t=>{const{selectedUser:l,messages:n}=a();try{const c=await k.post(`/messages/send/${l._id}`,t);s({messages:[...n,c.data]})}catch(c){a().handleError(c)}},subscribeToMessages:()=>{const{selectedUser:t}=a();if(!t)return;N.getState().socket.on("newMessage",n=>{n.senderId===t._id&&s({messages:[...a().messages,n]})})},unsubscribeFromMessages:()=>{const t=N.getState().socket;t==null||t.off("newMessage")},setSelectedUser:t=>s({selectedUser:t})})),Q=()=>e.jsx("div",{className:"relative mx-auto lg:mx-0",children:e.jsx("div",{className:"skeleton size-12 rounded-full"})}),X=()=>e.jsxs("div",{className:"hidden lg:block text-left min-w-0 flex-1",children:[e.jsx("div",{className:"skeleton h-4 w-32 mb-2"}),e.jsx("div",{className:"skeleton h-3 w-16"})]}),Z=()=>{const s=Array(8).fill(null);return e.jsxs("aside",{className:"h-full w-20 lg:w-72 border-r border-base-300 flex flex-col transition-all duration-200",children:[e.jsx("div",{className:"border-b border-base-300 w-full p-5",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(B,{className:"w-6 h-6"}),e.jsx("span",{className:"font-medium hidden lg:block",children:"Contacts"})]})}),e.jsx("div",{className:"overflow-y-auto w-full py-3",children:s.map((a,t)=>e.jsxs("div",{className:"w-full p-3 flex items-center gap-3",children:[e.jsx(Q,{}),e.jsx(X,{})]},t))})]})},I=(s,a)=>a.includes(s),G=({user:s,selectedUser:a,setSelectedUser:t,onlineUsers:l})=>{const n=I(s._id,l),c=(a==null?void 0:a._id)===s._id;return e.jsxs("button",{onClick:()=>t(s),className:`w-full p-3 flex items-center gap-3 hover:bg-base-300 transition-colors
        ${c?"bg-base-300 ring-1 ring-base-300":""}`,children:[e.jsxs("div",{className:"relative mx-auto lg:mx-0",children:[e.jsx("img",{src:s.profilePic||"/avatar.png",alt:s.name,className:"size-12 object-cover rounded-full"}),e.jsx("span",{className:`absolute bottom-0 right-0 size-3 
            rounded-full ring-2 ring-zinc-900 ${n?"bg-green-500":"bg-red-500"}`})]}),e.jsxs("div",{className:"hidden lg:block text-left min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:s.fullName}),e.jsx("div",{className:"text-sm text-zinc-400",children:n?"Online":"Offline"})]})]})},J=()=>{const{getAllUsers:s,getUsers:a,users:t,allUsers:l,selectedUser:n,setSelectedUser:c,isUsersLoading:p}=y(),{onlineUsers:x}=N(),[u,g]=i.useState(!1),[d,h]=i.useState(""),[f,S]=i.useState("");i.useEffect(()=>{const r=setTimeout(()=>{S(d)},300);return()=>clearTimeout(r)},[d]),i.useEffect(()=>{a()},[a]),i.useEffect(()=>{s()},[s]);const w=i.useMemo(()=>{let r=u?t.filter(v=>I(v._id,x)):t;return f&&(r=r.filter(v=>v.fullName.toLowerCase().includes(f.toLowerCase()))),r},[u,t,x,f]);return p?e.jsx(Z,{}):e.jsxs("aside",{className:"h-full lg:w-72 border-r border-base-300 flex flex-col transition-all duration-200",children:[e.jsxs("div",{className:"border-b border-base-300 w-full p-5",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"flex items-center justify-between w-full",children:[e.jsx("div",{className:"hidden lg:block",children:e.jsx("span",{className:"font-medium ml-1",children:"Chats"})}),e.jsxs("button",{onClick:()=>document.getElementById("all-users-modal").showModal(),className:"btn btn-sm flex items-center gap-2",children:[e.jsx(V,{className:"size-5"}),e.jsx("span",{className:"font-medium hidden lg:block",children:"Add"})]})]}),e.jsxs("label",{className:"hidden lg:flex input input-sm h-[2.5rem] input-bordered items-center gap-2 w-full mt-3",children:[e.jsx(W,{className:"size-4"}),e.jsx("input",{type:"text",className:"grow",placeholder:"Search or start new chat",value:d,onChange:r=>h(r.target.value)})]})]}),e.jsx("dialog",{open:!1,id:"all-users-modal",className:"modal modal-sm lg:modal-lg",children:e.jsxs("div",{className:"modal-box",children:[e.jsx("form",{method:"dialog",children:e.jsx("button",{className:"btn btn-sm btn-circle btn-ghost absolute right-2 top-2",children:"âœ•"})}),e.jsx("h3",{className:"font-bold text-lg",children:"All Users"}),e.jsx("div",{className:"space-y-2 mt-4",children:l.map(r=>e.jsxs("div",{className:"w-full px-3 py-1.5 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"relative",children:e.jsx("img",{src:r.profilePic||"/avatar.png",alt:r.name,className:"size-12 object-cover rounded-full border border-secondary"})}),e.jsxs("div",{className:"text-left min-w-0",children:[e.jsx("div",{className:"font-medium text-primary truncate",children:r.fullName}),e.jsx("div",{className:"text-sm text-primary/75",children:r.email})]})]}),e.jsx("div",{children:e.jsx("button",{onClick:()=>{c(r),document.getElementById("all-users-modal").close()},className:"btn btn-sm btn-ghost transition-colors hover:bg-base-300",children:"Chat"})})]},r._id))})]})}),x.length-1>0&&e.jsxs("div",{className:"mt-3 hidden lg:flex items-center justify-between gap-2",children:[e.jsxs("label",{className:"cursor-pointer flex items-center gap-2 ml-1",children:[e.jsx("input",{type:"checkbox",checked:u,onChange:r=>g(r.target.checked),className:"checkbox checkbox-sm"}),e.jsx("span",{className:"text-sm",children:"Show online only"})]}),e.jsxs("span",{className:"text-xs text-zinc-500",children:["(",x.length-1," online)"]})]})]}),e.jsxs("div",{className:"overflow-y-auto w-full py-3",children:[w.map(r=>e.jsx(G,{user:r,selectedUser:n,setSelectedUser:c,onlineUsers:x},r._id)),w.length===0&&e.jsx("div",{className:"text-center text-zinc-500 py-4",children:"No users available"})]})]})},K=()=>e.jsx("div",{className:"w-16 h-16 rounded-2xl bg-primary/10 flex items-center justify-center animate-bounce",children:e.jsx(D,{className:"w-8 h-8 text-primary"})}),Y=()=>e.jsxs("div",{className:"text-center space-y-6",children:[e.jsx("h2",{className:"text-2xl font-bold","aria-label":"Welcome message",children:"Welcome to Chatty!"}),e.jsx("p",{className:"text-base-content/60",children:"Select a conversation from the sidebar to start chatting"})]}),ee=()=>e.jsx("div",{className:"w-full flex flex-1 flex-col items-center justify-center p-16 bg-base-100/50",children:e.jsxs("div",{className:"max-w-md",children:[e.jsx("div",{className:"flex justify-center gap-4 mb-4",children:e.jsx(K,{})}),e.jsx(Y,{})]})}),z=()=>{const{selectedUser:s,setSelectedUser:a}=y(),{onlineUsers:t}=N(),l=n=>t.includes(n)?"Online":"Offline";return s?e.jsx("div",{className:"p-2.5 border-b border-base-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"avatar",children:e.jsx("div",{className:"size-10 rounded-full relative",children:e.jsx("img",{src:s.profilePic||"/avatar.png",alt:s.fullName,className:"object-cover rounded-full"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.fullName}),e.jsx("p",{className:"text-sm text-base-content/70",children:l(s._id)})]})]}),e.jsx("button",{onClick:()=>a(null),className:"btn btn-ghost p-0","aria-label":"Close chat",children:e.jsx(U,{})})]})}):null},E=()=>{const[s,a]=i.useState(""),[t,l]=i.useState(null),[n,c]=i.useState(null),[p,x]=i.useState(null),[u,g]=i.useState(!1),d=i.useRef(null),h=i.useRef(null),{sendMessage:f}=y(),S=o=>{const m=o.target.files[0];if(m&&!m.type.startsWith("image/")){M.error("Please select a valid image file.");return}if(m){const b=new FileReader;b.onloadend=()=>{l(b.result)},b.readAsDataURL(m)}},w=o=>{const m=o.target.files[0];if(m&&!m.type.startsWith("application/")){M.error("Please select a valid document file.");return}if(m){const b=new FileReader;b.onloadend=()=>{c(m.name),x(b.result)},b.readAsDataURL(m)}},r=()=>{l(null),d.current&&(d.current.value="")},v=()=>{c(null),h.current&&(h.current.value="")},_=async o=>{if(o.preventDefault(),!(!s.trim()&&!t&&!n))try{await f({text:s.trim(),image:t,document:p}),P()}catch(m){console.error("Failed to send message:",m)}},L=o=>{a(m=>m+o.native),g(!1)},P=()=>{a(""),l(null),c(null),d.current&&(d.current.value=""),h.current&&(h.current.value="")};return e.jsxs("div",{className:"p-4 w-full",children:[t&&e.jsx("div",{className:"mb-3 flex items-center gap-2",children:e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:t,alt:"Preview",className:"w-20 h-20 object-cover rounded-lg border border-zinc-700"}),e.jsx("button",{onClick:r,className:"absolute -top-1.5 -right-1.5 w-5 h-5 rounded-full bg-base-300 flex items-center justify-center",type:"button",children:e.jsx(U,{className:"size-3"})})]})}),n&&e.jsx("div",{className:"mb-3 flex items-center gap-2 truncate max-w-[256px]",children:e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"bg-gray-200 p-2 rounded-md cursor-pointer flex items-center",children:[e.jsx(C,{size:20,className:"mr-2"}),e.jsx("span",{children:n})]}),e.jsx("button",{onClick:v,className:"absolute -top-1.5 -right-1.5 w-5 h-5 rounded-full bg-base-300 flex items-center justify-center",type:"button",children:e.jsx(U,{className:"size-3"})})]})}),e.jsxs("form",{onSubmit:_,className:"flex items-center gap-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",className:"btn btn-sm btn-circle",onClick:()=>g(!u),children:e.jsx(F,{size:22})}),u&&e.jsx("div",{className:"absolute bottom-full left-0 mb-2",children:e.jsx(A,{searchPosition:"none",maxFrequentRows:2,previewPosition:"none",navPosition:"bottom",perLine:7,data:R,onEmojiSelect:L,theme:"auto",set:"apple"})})]}),e.jsxs("div",{className:"flex-1 flex gap-2 items-center",children:[e.jsxs("div",{className:"dropdown dropdown-top",children:[e.jsx("div",{tabIndex:0,role:"button",className:"m-1 btn btn-sm btn-circle",children:e.jsx(T,{})}),e.jsx("div",{tabIndex:0,className:"dropdown-content text-primary-content z-[1] shadow",children:e.jsxs("div",{className:"card-body",children:[e.jsx("input",{type:"file",accept:"image/*",className:"hidden",ref:d,onChange:S}),e.jsxs("button",{type:"button",className:`w-[140px] flex items-center justify-between gap-x-4  ${t?"text-emerald-500":"text-zinc-400"}`,onClick:()=>{var o;return(o=d.current)==null?void 0:o.click()},children:[e.jsx(H,{size:20})," Upload Image"]}),e.jsx("input",{type:"file",accept:"application/pdf",className:"hidden",ref:h,onChange:w}),e.jsxs("button",{type:"button",className:`w-[128px] flex items-center justify-between gap-x-4 ${n?"text-emerald-500":"text-zinc-400"}`,onClick:()=>{var o;return(o=h.current)==null?void 0:o.click()},children:[e.jsx(C,{size:20})," Upload PDF"]})]})})]}),e.jsx("input",{type:"text",className:"w-full input input-bordered rounded-lg input-sm sm:input-md",placeholder:"Type a message...",value:s,onChange:o=>a(o.target.value)})]}),e.jsx("button",{type:"submit",className:"btn btn-circle",disabled:!s.trim()&&!t&&!n,children:e.jsx(O,{size:22})})]})]})},se=()=>{const s=Array(6).fill(null),a="200px",t="16px",l="size-10";return e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:s.map((n,c)=>e.jsxs("div",{className:`chat ${c%2===0?"chat-start":"chat-end"}`,children:[e.jsx("div",{className:"chat-image avatar",children:e.jsx("div",{className:`rounded-full ${l}`,children:e.jsx("div",{className:"skeleton w-full h-full rounded-full"})})}),e.jsx("div",{className:"chat-header mb-1",children:e.jsx("div",{className:"skeleton h-4 w-16"})}),e.jsx("div",{className:"chat-bubble bg-transparent p-0",children:e.jsx("div",{className:`skeleton h-${t} w-[${a}]`})})]},c))})};function te(s){return new Date(s).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})}const ae=({message:s,authUser:a,selectedUser:t,setModalImage:l,setModalDocument:n})=>e.jsxs("div",{className:`chat ${s.senderId===a._id?"chat-end":"chat-start"}`,children:[e.jsx("div",{className:"chat-image avatar",children:e.jsx("div",{className:"size-10 rounded-full border",children:e.jsx("img",{src:s.senderId===a._id?a.profilePic||"/avatar.png":t.profilePic||"/avatar.png",alt:"profile pic"})})}),e.jsx("div",{className:"chat-header mb-1",children:e.jsx("time",{className:"text-xs opacity-50 ml-1",children:te(s.createdAt)})}),e.jsxs("div",{className:"chat-bubble flex flex-col",children:[s.image&&e.jsx("img",{onClick:()=>{l({src:s.image,text:s.text})},src:s.image,alt:"Attachment",className:"sm:max-w-[200px] rounded-md mb-2"}),s.document&&e.jsxs("div",{onClick:()=>n({src:s.document,text:s.text}),className:"bg-gray-200 text-black py-2 px-4 rounded-md cursor-pointer mb-2 w-[200px] flex items-center justify-between",children:[e.jsx(q,{}),e.jsx("span",{children:s.documentName||"New Document.pdf"})]}),s.text&&(s.text.startsWith("http")?e.jsx("a",{target:"_blank",className:"link",href:s.text,children:s.text}):e.jsx("p",{children:s.text}))]})]},s._id),le=()=>{const{messages:s,getMessages:a,isMessagesLoading:t,selectedUser:l,subscribeToMessages:n,unsubscribeFromMessages:c}=y(),{authUser:p}=N(),x=i.useRef(null),[u,g]=i.useState({src:"",text:""}),[d,h]=i.useState({src:"",text:""});return i.useEffect(()=>(l!=null&&l._id&&(a(l._id),n()),()=>c()),[l==null?void 0:l._id,a,n,c]),i.useEffect(()=>{x.current&&s&&x.current.scrollIntoView({behavior:"smooth"})},[s]),i.useEffect(()=>{u.src&&document.getElementById("image_modal").showModal()},[u]),i.useEffect(()=>{d.src&&document.getElementById("document_modal").showModal()},[d]),t?e.jsxs("div",{className:"flex-1 flex flex-col overflow-auto",children:[e.jsx(z,{}),e.jsx(se,{}),e.jsx(E,{})]}):e.jsxs("div",{className:"flex-1 flex flex-col overflow-auto",children:[e.jsx(z,{}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:s.length>0?s.map(f=>e.jsx(ae,{setModalImage:g,setModalDocument:h,message:f,authUser:p,selectedUser:l},f._id)):e.jsx("div",{className:"text-center text-zinc-500",children:"No messages yet"})}),e.jsxs("dialog",{id:"image_modal",className:"modal",children:[e.jsx("div",{className:"modal-box max-w-xl flex items-center justify-center",children:e.jsx("img",{src:u.src,alt:"Attachment",className:"rounded-md size-auto"})}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{children:"close"})})]}),e.jsxs("dialog",{id:"document_modal",className:"modal",children:[e.jsxs("div",{className:"modal-box max-w-5xl",children:[e.jsx("iframe",{src:d.src,width:"100%",height:"500px",className:"border-0",title:"Document Viewer"}),e.jsx("p",{className:"text-center text-sm mt-2",children:d.text})]}),e.jsx("form",{method:"dialog",className:"modal-backdrop",children:e.jsx("button",{children:"close"})})]}),e.jsx(E,{}),e.jsx("div",{ref:x})]})},re=()=>{const{selectedUser:s}=y();return e.jsx("div",{className:"h-screen bg-base-200",children:e.jsx("div",{className:"flex items-center justify-center pt-20 px-4",children:e.jsx("div",{className:"bg-base-100 rounded-lg shadow-cl w-full max-w-6xl h-[calc(100vh-6rem)]",children:e.jsxs("div",{className:"flex h-full rounded-lg overflow-hidden",children:[e.jsx(J,{}),s?e.jsx(le,{}):e.jsx(ee,{})]})})})})};export{re as default};
